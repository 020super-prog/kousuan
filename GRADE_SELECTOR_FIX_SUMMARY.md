# å¹´çº§é€‰æ‹©åŠŸèƒ½ä¿®å¤æ€»ç»“

## ğŸ“Š é—®é¢˜è¯Šæ–­æŠ¥å‘Š

### é—®é¢˜æ¦‚è¿°
é¦–é¡µå¹´çº§é€‰æ‹©å™¨æ— æ³•æ­£å¸¸å·¥ä½œï¼Œç”¨æˆ·ç‚¹å‡»é€‰æ‹©å™¨åæ— å“åº”æˆ–é€‰æ‹©åæ— æ•ˆæœã€‚

### æ ¹å› åˆ†æ

| é—®é¢˜ç¼–å· | ä¸¥é‡çº§åˆ« | é—®é¢˜æè¿° | å½±å“èŒƒå›´ | çŠ¶æ€ |
|---------|---------|---------|---------|------|
| **P0** | ğŸ”´ è‡´å‘½ | `t-picker-item` ç»„ä»¶æœªæ³¨å†Œ | é€‰æ‹©å™¨å®Œå…¨ä¸å¯ç”¨ | âœ… å·²ä¿®å¤ |
| **P1** | ğŸŸ  ä¸¥é‡ | å¹´çº§æ•°æ®æ ¼å¼ä¸ç¬¦åˆTDesignè§„èŒƒ | é€‰æ‹©å™¨æ— é€‰é¡¹æ˜¾ç¤º | âœ… å·²ä¿®å¤ |
| **P2** | ğŸŸ¡ ä¸­ç­‰ | é€‰æ‹©å™¨ç´¢å¼•æœªè¿½è¸ª | æ— æ³•è®°ä½ç”¨æˆ·é€‰æ‹© | âœ… å·²ä¿®å¤ |
| **P3** | ğŸŸ¢ è½»å¾® | ç¼ºå°‘è°ƒè¯•æ—¥å¿— | é—®é¢˜æ’æŸ¥å›°éš¾ | âœ… å·²ä¿®å¤ |
| **P4** | âšª å¾…ç¡®è®¤ | äº‘å¼€å‘ç¯å¢ƒIDæœªé…ç½® | äº‘å‡½æ•°è°ƒç”¨å¯èƒ½å¤±è´¥ | âš ï¸ éœ€ç”¨æˆ·é…ç½® |

---

## ğŸ”§ å·²å®æ–½çš„ä¿®å¤

### ä¿®å¤1ï¼šæ³¨å†Œ t-picker-item ç»„ä»¶

**æ–‡ä»¶ï¼š** `miniprogram/app.json`

**å˜æ›´ï¼š**
```diff
  "usingComponents": {
    "t-picker": "tdesign-miniprogram/picker/picker",
+   "t-picker-item": "tdesign-miniprogram/picker-item/picker-item",
    ...
  }
```

**åŸå› ï¼š**
TDesignçš„Pickeræ˜¯ç»„åˆç»„ä»¶ï¼Œéœ€è¦åŒæ—¶æ³¨å†Œçˆ¶ç»„ä»¶(`t-picker`)å’Œå­ç»„ä»¶(`t-picker-item`)ã€‚ç¼ºå°‘å­ç»„ä»¶æ³¨å†Œä¼šå¯¼è‡´é€‰æ‹©å™¨å†…éƒ¨æ— æ³•æ­£å¸¸æ¸²æŸ“é€‰é¡¹åˆ—è¡¨ã€‚

**å½±å“ï¼š**
- ä¿®å¤å‰ï¼šæ§åˆ¶å°æŠ¥é”™ "Component is not found in path 'tdesign-miniprogram/picker-item/picker-item'"
- ä¿®å¤åï¼šé€‰æ‹©å™¨å¯ä»¥æ­£å¸¸å¼¹å‡ºå¹¶æ˜¾ç¤ºé€‰é¡¹

---

### ä¿®å¤2ï¼šè§„èŒƒåŒ–å¹´çº§æ•°æ®æ ¼å¼

**æ–‡ä»¶ï¼š** `miniprogram/pages/home/index.js`

**å˜æ›´ï¼š**
```javascript
// ä¿®å¤å‰
const res = await getAllGrades();
this.setData({
  grades: res.data  // [{key: 'grade_1_2', name: 'ä¸€äºŒå¹´çº§', level: 1}, ...]
});

// ä¿®å¤å
const res = await getAllGrades();
const grades = res.data.map(grade => ({
  label: grade.name,    // TDesignè¦æ±‚çš„æ˜¾ç¤ºæ–‡æœ¬å­—æ®µ
  value: grade.key      // TDesignè¦æ±‚çš„å€¼å­—æ®µ
}));
this.setData({
  grades: grades  // [{label: 'ä¸€äºŒå¹´çº§', value: 'grade_1_2'}, ...]
});
```

**åŸå› ï¼š**
TDesign Pickerç»„ä»¶è¦æ±‚é€‰é¡¹æ•°æ®å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- `label`: æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ–‡æœ¬
- `value`: é€‰é¡¹çš„å®é™…å€¼

äº‘å‡½æ•°è¿”å›çš„åŸå§‹æ ¼å¼ä½¿ç”¨ `name` å’Œ `key`ï¼Œä¸ç¬¦åˆç»„ä»¶è§„èŒƒã€‚

**å‚è€ƒï¼š**
[TDesign Picker APIæ–‡æ¡£](https://tdesign.tencent.com/miniprogram/components/picker)

---

### ä¿®å¤3ï¼šå®ç°é€‰æ‹©å™¨ç´¢å¼•è¿½è¸ª

**æ–‡ä»¶ï¼š** `miniprogram/pages/home/index.js` + `index.wxml`

**å˜æ›´ï¼š**

**JSéƒ¨åˆ†ï¼š**
```javascript
// æ–°å¢æ•°æ®å­—æ®µ
data: {
  selectedGradeIndex: 0,  // è®°å½•å½“å‰é€‰ä¸­çš„å¹´çº§åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•
  ...
}

// åŠ è½½å¹´çº§æ—¶è®¡ç®—ç´¢å¼•
async loadSelectedGrade() {
  let gradeKey = wx.getStorageSync('selectedGrade') || 'grade_1_2';
  const gradeIndex = this.data.grades.findIndex(g => g.value === gradeKey);
  
  this.setData({
    selectedGrade: gradeKey,
    selectedGradeName: getGradeName(gradeKey),
    selectedGradeIndex: gradeIndex >= 0 ? gradeIndex : 0  // æ–°å¢
  });
}

// é€‰æ‹©ç¡®è®¤æ—¶æ›´æ–°ç´¢å¼•
async onGradeConfirm(e) {
  const selectedIndex = e.detail.value[0];
  const gradeKey = this.data.grades[selectedIndex].value;
  
  this.setData({
    selectedGrade: gradeKey,
    selectedGradeName: getGradeName(gradeKey),
    selectedGradeIndex: selectedIndex,  // æ–°å¢
    showGradePicker: false
  });
}
```

**WXMLéƒ¨åˆ†ï¼š**
```xml
<!-- ä¿®å¤å‰ -->
<t-picker value="{{[0]}}" ...>

<!-- ä¿®å¤å -->
<t-picker value="{{[selectedGradeIndex]}}" ...>
```

**åŸå› ï¼š**
- ä¿®å¤å‰ï¼š`value` å›ºå®šä¸º `[0]`ï¼Œæ¯æ¬¡æ‰“å¼€é€‰æ‹©å™¨éƒ½é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªå¹´çº§
- ä¿®å¤åï¼š`value` ç»‘å®šåŠ¨æ€ç´¢å¼•ï¼Œé€‰æ‹©å™¨ä¼šé«˜äº®æ˜¾ç¤ºå½“å‰å·²é€‰å¹´çº§

**ç”¨æˆ·ä½“éªŒæå‡ï¼š**
- ç”¨æˆ·å†æ¬¡æ‰“å¼€é€‰æ‹©å™¨æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ä¹‹å‰çš„é€‰æ‹©
- é¿å…é‡å¤é€‰æ‹©å’Œè¯¯æ“ä½œ

---

### ä¿®å¤4ï¼šå¢å¼ºè°ƒè¯•æ—¥å¿—

**æ–‡ä»¶ï¼š** `miniprogram/pages/home/index.js`

**æ–°å¢æ—¥å¿—ç‚¹ï¼š**

```javascript
// 1. å¹´çº§æ•°æ®åŠ è½½æ—¥å¿—
async loadGrades() {
  const res = await getAllGrades();
  console.log('å¹´çº§æ•°æ®åŠ è½½ç»“æœ:', res);  // âœ… æ–°å¢
  console.log('æ ¼å¼åŒ–åçš„å¹´çº§æ•°æ®:', grades);  // âœ… æ–°å¢
}

// 2. å¹´çº§é€‰æ‹©ç¡®è®¤æ—¥å¿—
async onGradeConfirm(e) {
  console.log('å¹´çº§é€‰æ‹©ç¡®è®¤äº‹ä»¶:', e.detail);  // âœ… æ–°å¢
  console.log('é€‰ä¸­çš„å¹´çº§:', gradeKey);  // âœ… æ–°å¢
}

// 3. é”™è¯¯æ—¥å¿—å¢å¼º
catch (error) {
  console.error('åŠ è½½å¹´çº§å¤±è´¥:', error);
  Message.error({
    content: 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥äº‘å‡½æ•°é…ç½®'  // âœ… æ›´è¯¦ç»†çš„æç¤º
  });
}
```

**ä½œç”¨ï¼š**
- ä¾¿äºå¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜
- å¸®åŠ©ç†è§£æ•°æ®æµè½¬è¿‡ç¨‹
- æä¾›æ¸…æ™°çš„é”™è¯¯æç¤º

---

## âš ï¸ éœ€è¦ç”¨æˆ·é…ç½®çš„é¡¹ç›®

### é…ç½®1ï¼šäº‘å¼€å‘ç¯å¢ƒIDï¼ˆå¿…é¡»ï¼‰

**æ–‡ä»¶ï¼š** `miniprogram/app.js`

**å½“å‰çŠ¶æ€ï¼š**
```javascript
wx.cloud.init({
  env: "",  // âš ï¸ ç©ºå­—ç¬¦ä¸²ï¼Œéœ€è¦é…ç½®
  traceUser: true,
});
```

**é…ç½®æ­¥éª¤ï¼š**

1. **è·å–äº‘ç¯å¢ƒID**
   - æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
   - ç‚¹å‡»å·¥å…·æ çš„"äº‘å¼€å‘"æŒ‰é’®
   - åœ¨äº‘å¼€å‘æ§åˆ¶å°å·¦ä¸Šè§’å¯ä»¥çœ‹åˆ°ç¯å¢ƒåç§°å’ŒID
   - IDæ ¼å¼ç±»ä¼¼ï¼š`cloud1-xxxxx`

2. **å¡«å…¥é…ç½®**
   ```javascript
   wx.cloud.init({
     env: "cloud1-xxxxx",  // æ›¿æ¢ä¸ºä½ çš„çœŸå®ç¯å¢ƒID
     traceUser: true,
   });
   ```

3. **é‡æ–°ç¼–è¯‘**
   - ä¿å­˜æ–‡ä»¶åé‡æ–°ç¼–è¯‘å°ç¨‹åº
   - æˆ–ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®

**éªŒè¯æ–¹æ³•ï¼š**
æ‰“å¼€æ§åˆ¶å°ï¼Œæ‰§è¡Œï¼š
```javascript
wx.cloud.callFunction({
  name: 'gradeEngine',
  data: { action: 'getAllGrades', data: {} }
}).then(res => console.log('æˆåŠŸ:', res))
  .catch(err => console.error('å¤±è´¥:', err));
```

å¦‚æœæˆåŠŸï¼Œä¼šçœ‹åˆ°å¹´çº§æ•°æ®ï¼›å¦‚æœå¤±è´¥ï¼Œä¼šæç¤ºå…·ä½“é”™è¯¯ã€‚

---

### é…ç½®2ï¼šä¸Šä¼ äº‘å‡½æ•°ï¼ˆå¿…é¡»ï¼‰

**æ£€æŸ¥äº‘å‡½æ•°æ˜¯å¦å·²éƒ¨ç½²ï¼š**

1. æ‰“å¼€äº‘å¼€å‘æ§åˆ¶å°
2. ç‚¹å‡»"äº‘å‡½æ•°"æ ‡ç­¾
3. æŸ¥çœ‹åˆ—è¡¨ä¸­æ˜¯å¦æœ‰ `gradeEngine`

**å¦‚æœäº‘å‡½æ•°ä¸å­˜åœ¨æˆ–éœ€è¦æ›´æ–°ï¼š**

**æ–¹å¼1ï¼šå¼€å‘è€…å·¥å…·ç•Œé¢**
1. åœ¨é¡¹ç›®ç›®å½•æ ‘ä¸­æ‰¾åˆ° `cloudfunctions/gradeEngine`
2. å³é”®ç‚¹å‡»è¯¥ç›®å½•
3. é€‰æ‹©"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"
4. ç­‰å¾…ä¸Šä¼ å®Œæˆï¼ˆçº¦1-2åˆ†é’Ÿï¼‰

**æ–¹å¼2ï¼šå‘½ä»¤è¡Œï¼ˆéœ€å…ˆé…ç½®ï¼‰**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./uploadCloudFunction.sh
```

**éªŒè¯éƒ¨ç½²æˆåŠŸï¼š**
- äº‘å‡½æ•°åˆ—è¡¨ä¸­çŠ¶æ€æ˜¾ç¤º"éƒ¨ç½²æˆåŠŸ"
- å¯ä»¥åœ¨äº‘å‡½æ•°è¯¦æƒ…é¡µæŸ¥çœ‹æ—¥å¿—
- ä½¿ç”¨ä¸Šé¢çš„éªŒè¯ä»£ç æµ‹è¯•è°ƒç”¨

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æµ‹è¯•ç¯å¢ƒå‡†å¤‡

- [ ] å¾®ä¿¡å¼€å‘è€…å·¥å…·ç‰ˆæœ¬ â‰¥ 1.05.0
- [ ] å°ç¨‹åºåŸºç¡€åº“ç‰ˆæœ¬ â‰¥ 2.20.1
- [ ] å·²é…ç½®äº‘å¼€å‘ç¯å¢ƒID
- [ ] å·²ä¸Šä¼  gradeEngine äº‘å‡½æ•°
- [ ] TDesignç»„ä»¶åº“å·²æ„å»ºï¼ˆnpmå·²æ„å»ºï¼‰

### æµ‹è¯•ç”¨ä¾‹

#### ç”¨ä¾‹1ï¼šé¦–æ¬¡åŠ è½½
**æ­¥éª¤ï¼š**
1. æ‰“å¼€å°ç¨‹åºï¼ˆé¦–é¡µï¼‰
2. è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º

**é¢„æœŸç»“æœï¼š**
```
å¹´çº§æ•°æ®åŠ è½½ç»“æœ: {success: true, data: [{key: 'grade_1_2', ...}, ...]}
æ ¼å¼åŒ–åçš„å¹´çº§æ•°æ®: [{label: 'ä¸€äºŒå¹´çº§', value: 'grade_1_2'}, ...]
```
- é¡µé¢æ˜¾ç¤º"å½“å‰å¹´çº§ï¼šä¸€äºŒå¹´çº§"ï¼ˆé»˜è®¤ï¼‰
- å¿«æ·ç»ƒä¹ åŒºåŸŸæ˜¾ç¤º6ä¸ªé¢˜å‹æŒ‰é’®

**å®é™…ç»“æœï¼š** _________

---

#### ç”¨ä¾‹2ï¼šæ‰“å¼€å¹´çº§é€‰æ‹©å™¨
**æ­¥éª¤ï¼š**
1. ç‚¹å‡»"è¯·é€‰æ‹©å¹´çº§"æŒ‰é’®
2. è§‚å¯Ÿé€‰æ‹©å™¨å¼¹çª—

**é¢„æœŸç»“æœï¼š**
- é€‰æ‹©å™¨ä»åº•éƒ¨æ»‘å‡º
- æ˜¾ç¤ºæ ‡é¢˜"é€‰æ‹©å¹´çº§"
- åˆ—è¡¨æ˜¾ç¤ºä¸‰ä¸ªé€‰é¡¹ï¼š
  - ä¸€äºŒå¹´çº§ âœ“ï¼ˆé«˜äº®æ˜¾ç¤ºï¼Œè¡¨ç¤ºå½“å‰é€‰ä¸­ï¼‰
  - ä¸‰å››å¹´çº§
  - äº”å…­å¹´çº§
- æœ‰"å–æ¶ˆ"å’Œ"ç¡®è®¤"æŒ‰é’®

**å®é™…ç»“æœï¼š** _________

---

#### ç”¨ä¾‹3ï¼šåˆ‡æ¢å¹´çº§
**æ­¥éª¤ï¼š**
1. åœ¨é€‰æ‹©å™¨ä¸­é€‰æ‹©"ä¸‰å››å¹´çº§"
2. ç‚¹å‡»"ç¡®è®¤"æŒ‰é’®
3. è§‚å¯Ÿæ§åˆ¶å°å’Œé¡µé¢å˜åŒ–

**é¢„æœŸç»“æœï¼š**
- æ§åˆ¶å°è¾“å‡ºï¼š
  ```
  å¹´çº§é€‰æ‹©ç¡®è®¤äº‹ä»¶: {value: [1]}
  é€‰ä¸­çš„å¹´çº§: grade_3_4
  ```
- é¡µé¢é¡¶éƒ¨Toastæç¤ºï¼š"å·²åˆ‡æ¢åˆ°ä¸‰å››å¹´çº§"
- å¹´çº§é€‰æ‹©æŒ‰é’®æ˜¾ç¤ºï¼š"ä¸‰å››å¹´çº§"
- å¿«æ·ç»ƒä¹ åŒºåŸŸæ›´æ–°ä¸ºä¸‰å››å¹´çº§çš„é¢˜å‹ï¼ˆåº”è¯¥æœ‰7ä¸ªï¼‰

**å®é™…ç»“æœï¼š** _________

---

#### ç”¨ä¾‹4ï¼šå†æ¬¡æ‰“å¼€é€‰æ‹©å™¨
**æ­¥éª¤ï¼š**
1. å†æ¬¡ç‚¹å‡»å¹´çº§é€‰æ‹©æŒ‰é’®
2. è§‚å¯Ÿé€‰æ‹©å™¨æ˜¾ç¤º

**é¢„æœŸç»“æœï¼š**
- "ä¸‰å››å¹´çº§"åº”è¯¥è¢«é«˜äº®é€‰ä¸­ï¼ˆè€Œä¸æ˜¯ä¸€äºŒå¹´çº§ï¼‰
- è¯æ˜ç´¢å¼•è¿½è¸ªåŠŸèƒ½æ­£å¸¸

**å®é™…ç»“æœï¼š** _________

---

#### ç”¨ä¾‹5ï¼šå–æ¶ˆé€‰æ‹©
**æ­¥éª¤ï¼š**
1. æ‰“å¼€é€‰æ‹©å™¨
2. æ»šåŠ¨åˆ°"äº”å…­å¹´çº§"
3. ç‚¹å‡»"å–æ¶ˆ"æŒ‰é’®

**é¢„æœŸç»“æœï¼š**
- é€‰æ‹©å™¨å…³é—­
- å½“å‰å¹´çº§ä¸å˜ï¼ˆä»ä¸º"ä¸‰å››å¹´çº§"ï¼‰
- é¢˜å‹åˆ—è¡¨ä¸å˜

**å®é™…ç»“æœï¼š** _________

---

#### ç”¨ä¾‹6ï¼šé¢˜å‹ç‚¹å‡»è·³è½¬
**æ­¥éª¤ï¼š**
1. ç¡®ä¿å½“å‰å¹´çº§ä¸º"ä¸‰å››å¹´çº§"
2. ç‚¹å‡»ä»»æ„é¢˜å‹æŒ‰é’®ï¼ˆå¦‚"åŠ æ³•"ï¼‰

**é¢„æœŸç»“æœï¼š**
- è·³è½¬åˆ°ç»ƒä¹ é¡µ
- ç»ƒä¹ é¡µåº”åŠ è½½ä¸‰å››å¹´çº§çš„åŠ æ³•é¢˜ç›®

**å®é™…ç»“æœï¼š** _________

---

#### ç”¨ä¾‹7ï¼šåˆ·æ–°åè®°å¿†
**æ­¥éª¤ï¼š**
1. åˆ‡æ¢å¹´çº§åˆ°"äº”å…­å¹´çº§"
2. å…³é—­å°ç¨‹åºï¼ˆæˆ–åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢å†å›æ¥ï¼‰
3. é‡æ–°æ‰“å¼€é¦–é¡µ

**é¢„æœŸç»“æœï¼š**
- é¦–é¡µåº”æ˜¾ç¤º"äº”å…­å¹´çº§"
- å¿«æ·ç»ƒä¹ æ˜¾ç¤ºäº”å…­å¹´çº§çš„é¢˜å‹

**å®é™…ç»“æœï¼š** _________

---

## ğŸ› æ•…éšœæ’æŸ¥æŒ‡å—

### é—®é¢˜ï¼šé€‰æ‹©å™¨å®Œå…¨ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› ï¼š**
1. `showGradePicker` æœªè®¾ç½®ä¸º `true`
2. TDesignç»„ä»¶æœªæ­£ç¡®å¼•å…¥

**æ’æŸ¥æ­¥éª¤ï¼š**
```javascript
// åœ¨ showGradeSelector æ–¹æ³•ä¸­æ·»åŠ 
showGradeSelector() {
  console.log('ç‚¹å‡»é€‰æ‹©å™¨æŒ‰é’®');
  console.log('å½“å‰ showGradePicker:', this.data.showGradePicker);
  this.setData({ showGradePicker: true });
  console.log('æ›´æ–°å showGradePicker:', this.data.showGradePicker);
}
```

**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥ `app.json` ä¸­æ˜¯å¦æ³¨å†Œäº† `t-picker` å’Œ `t-picker-item`
- ç¡®è®¤ `tdesign-miniprogram` åŒ…å·²æ­£ç¡®æ„å»ºï¼ˆ`npm run build`ï¼‰

---

### é—®é¢˜ï¼šé€‰æ‹©å™¨æ˜¾ç¤ºä½†æ— é€‰é¡¹

**å¯èƒ½åŸå› ï¼š**
1. `grades` æ•°æ®ä¸ºç©º
2. æ•°æ®æ ¼å¼ä¸æ­£ç¡®
3. äº‘å‡½æ•°è°ƒç”¨å¤±è´¥

**æ’æŸ¥æ­¥éª¤ï¼š**
```javascript
// åœ¨ onLoad ä¸­æ·»åŠ 
onLoad() {
  this.loadGrades().then(() => {
    console.log('æœ€ç»ˆ grades æ•°æ®:', this.data.grades);
    console.log('grades é•¿åº¦:', this.data.grades.length);
    console.log('grades[0] ç»“æ„:', this.data.grades[0]);
  });
}
```

**è§£å†³æ–¹æ³•ï¼š**
- å¦‚æœ `grades` ä¸ºç©ºï¼Œæ£€æŸ¥äº‘å‡½æ•°æ˜¯å¦æ­£å¸¸è¿”å›
- å¦‚æœæ ¼å¼ä¸å¯¹ï¼Œç¡®è®¤æ•°æ®è½¬æ¢é€»è¾‘æ˜¯å¦æ‰§è¡Œ
- ä½¿ç”¨ `checkCloudConfig.js` å·¥å…·æµ‹è¯•äº‘å‡½æ•°è¿æ¥

---

### é—®é¢˜ï¼šé€‰æ‹©åé¡µé¢æ²¡æœ‰ååº”

**å¯èƒ½åŸå› ï¼š**
1. `onGradeConfirm` äº‹ä»¶æœªè§¦å‘
2. äº‹ä»¶ç»‘å®šåç§°é”™è¯¯
3. æ•°æ®æ›´æ–°å¤±è´¥

**æ’æŸ¥æ­¥éª¤ï¼š**
```javascript
// æ£€æŸ¥äº‹ä»¶æ˜¯å¦è§¦å‘
onGradeConfirm(e) {
  console.log('========== ç¡®è®¤äº‹ä»¶å¼€å§‹ ==========');
  console.log('äº‹ä»¶å‚æ•°:', e.detail);
  console.log('å½“å‰ grades:', this.data.grades);
  
  const selectedIndex = e.detail.value[0];
  console.log('é€‰ä¸­ç´¢å¼•:', selectedIndex);
  console.log('é€‰ä¸­çš„gradeå¯¹è±¡:', this.data.grades[selectedIndex]);
  
  // ... åç»­é€»è¾‘
  console.log('========== ç¡®è®¤äº‹ä»¶ç»“æŸ ==========');
}
```

**è§£å†³æ–¹æ³•ï¼š**
- ç¡®è®¤ WXML ä¸­çš„äº‹ä»¶ç»‘å®šï¼š`bindconfirm="onGradeConfirm"`ï¼ˆæ²¡æœ‰ `bind:confirm`ï¼‰
- æ£€æŸ¥ `e.detail.value` æ˜¯å¦ä¸ºæ•°ç»„
- ç¡®è®¤ `this.data.grades[index]` ä¸æ˜¯ undefined

---

### é—®é¢˜ï¼šäº‘å‡½æ•°è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
errCode: -1
errMsg: "cloud.callFunction:fail cloud init error"
```

**è§£å†³æ–¹æ³•ï¼š**
1. åœ¨ `app.js` ä¸­é…ç½®æ­£ç¡®çš„äº‘ç¯å¢ƒID
2. ç¡®ä¿äº‘å¼€å‘å·²å¼€é€šä¸”ç¯å¢ƒæ­£å¸¸

**é”™è¯¯ä¿¡æ¯ï¼š**
```
errCode: -1
errMsg: "cloud.callFunction:fail FunctionName is invalid"
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥äº‘å‡½æ•°åç§°æ˜¯å¦ä¸º `gradeEngine`ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰
2. ä¸Šä¼ äº‘å‡½æ•°åˆ°äº‘ç«¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
errCode: -501002
errMsg: "cloud.callFunction:fail requestID xxx, cloud function execution error"
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ‰“å¼€äº‘å¼€å‘æ§åˆ¶å° â†’ äº‘å‡½æ•° â†’ gradeEngine â†’ æ—¥å¿—
2. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. å¯èƒ½æ˜¯äº‘å‡½æ•°ä»£ç æœ‰è¯¯æˆ–ä¾èµ–æœªå®‰è£…

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ä¼˜åŒ–1ï¼šç¼“å­˜å¹´çº§æ•°æ®

**å½“å‰å®ç°ï¼š** æ¯æ¬¡è¿›å…¥é¦–é¡µéƒ½ä¼šè°ƒç”¨äº‘å‡½æ•°åŠ è½½å¹´çº§æ•°æ®

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
```javascript
async loadGrades() {
  // å…ˆä»ç¼“å­˜è¯»å–
  const cachedGrades = wx.getStorageSync('cached_grades');
  const cacheTime = wx.getStorageSync('cached_grades_time');
  const now = Date.now();
  
  // ç¼“å­˜æœ‰æ•ˆæœŸï¼š24å°æ—¶
  if (cachedGrades && cacheTime && (now - cacheTime < 24 * 60 * 60 * 1000)) {
    console.log('ä½¿ç”¨ç¼“å­˜çš„å¹´çº§æ•°æ®');
    this.setData({ grades: cachedGrades });
    return;
  }
  
  // ç¼“å­˜è¿‡æœŸæˆ–ä¸å­˜åœ¨ï¼Œä»äº‘ç«¯åŠ è½½
  wx.showLoading({ title: 'åŠ è½½ä¸­...' });
  try {
    const res = await getAllGrades();
    if (res.success) {
      const grades = res.data.map(grade => ({
        label: grade.name,
        value: grade.key
      }));
      
      // ä¿å­˜åˆ°ç¼“å­˜
      wx.setStorageSync('cached_grades', grades);
      wx.setStorageSync('cached_grades_time', now);
      
      this.setData({ grades });
    }
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error);
  } finally {
    wx.hideLoading();
  }
}
```

**æ•ˆæœï¼š**
- é¦–æ¬¡åŠ è½½åï¼Œåç»­æ‰“å¼€ç¬é—´æ˜¾ç¤º
- å‡å°‘äº‘å‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼ˆèŠ‚çœè´¹ç”¨ï¼‰
- ç¦»çº¿æƒ…å†µä¸‹ä»å¯ä½¿ç”¨

---

### ä¼˜åŒ–2ï¼šé¢„åŠ è½½é¢˜å‹æ•°æ®

**å½“å‰å®ç°ï¼š** é€‰æ‹©å¹´çº§åæ‰åŠ è½½é¢˜å‹æ•°æ®

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
```javascript
async loadGrades() {
  // ... åŠ è½½å¹´çº§ ...
  
  // é¢„åŠ è½½æ‰€æœ‰å¹´çº§çš„é¢˜å‹æ•°æ®
  const allCategories = {};
  for (const grade of grades) {
    const res = await getCategoriesByGrade(grade.value);
    if (res.success) {
      allCategories[grade.value] = res.data;
    }
  }
  
  // ä¿å­˜åˆ°å†…å­˜
  this.setData({ 
    grades,
    allCategoriesCache: allCategories
  });
}

async loadCategories(gradeKey) {
  // å…ˆä»å†…å­˜è¯»å–
  if (this.data.allCategoriesCache && this.data.allCategoriesCache[gradeKey]) {
    const categories = this.data.allCategoriesCache[gradeKey];
    // ç«‹å³æ˜¾ç¤º
    this.processCategories(categories);
    return;
  }
  
  // å†…å­˜ä¸­æ²¡æœ‰ï¼Œä»äº‘ç«¯åŠ è½½
  // ... åŸæœ‰é€»è¾‘ ...
}
```

**æ•ˆæœï¼š**
- å¹´çº§åˆ‡æ¢ç¬é—´å®Œæˆï¼Œæ— ç­‰å¾…
- æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒ

---

### ä¼˜åŒ–3ï¼šæ·»åŠ åŠ è½½åŠ¨ç”»

**å½“å‰å®ç°ï¼š** ä½¿ç”¨ `wx.showLoading`ï¼Œæ¯”è¾ƒç”Ÿç¡¬

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
ä½¿ç”¨TDesignçš„Loadingç»„ä»¶ï¼š

```xml
<!-- index.wxml -->
<t-loading
  wx:if="{{isLoadingGrades}}"
  theme="circular"
  size="40rpx"
  text="åŠ è½½å¹´çº§æ•°æ®..."
  layout="vertical"
  inheritColor
/>
```

```javascript
// index.js
async loadGrades() {
  this.setData({ isLoadingGrades: true });
  
  try {
    // ... åŠ è½½é€»è¾‘ ...
  } finally {
    this.setData({ isLoadingGrades: false });
  }
}
```

---

## ğŸ“ ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•

- [x] æ‰€æœ‰å¼‚æ­¥å‡½æ•°éƒ½æœ‰é”™è¯¯å¤„ç†
- [x] ç”¨æˆ·æ“ä½œéƒ½æœ‰åé¦ˆï¼ˆToast/Loadingï¼‰
- [x] å…³é”®æ“ä½œéƒ½æœ‰æ—¥å¿—è¾“å‡º
- [x] æ•°æ®æ ¼å¼è½¬æ¢æœ‰æ³¨é‡Šè¯´æ˜
- [x] ç»„ä»¶å±æ€§ç»‘å®šä½¿ç”¨åŒæ‹¬å· `{{}}`
- [x] äº‹ä»¶ç»‘å®šä½¿ç”¨ `bind:` æˆ– `bind` å‰ç¼€
- [x] æ•°æ®æ›´æ–°ä½¿ç”¨ `setData`
- [x] é¿å…åœ¨ `setData` ä¸­ä¼ é€’å¤§å¯¹è±¡
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ E2Eæµ‹è¯•ï¼ˆå¯é€‰ï¼‰

---

## ğŸ‰ éªŒæ”¶æ ‡å‡†

### åŸºç¡€åŠŸèƒ½ï¼ˆå¿…é¡»100%é€šè¿‡ï¼‰

- [ ] å¹´çº§é€‰æ‹©å™¨å¯ä»¥æ­£å¸¸æ‰“å¼€
- [ ] é€‰æ‹©å™¨æ˜¾ç¤ºä¸‰ä¸ªå¹´çº§é€‰é¡¹
- [ ] é€‰æ‹©å¹´çº§åé¡µé¢æ­£ç¡®æ›´æ–°
- [ ] é¢˜å‹åˆ—è¡¨æ ¹æ®å¹´çº§åŠ¨æ€åŠ è½½
- [ ] å†æ¬¡æ‰“å¼€é€‰æ‹©å™¨æ—¶é«˜äº®å½“å‰å¹´çº§
- [ ] åˆ·æ–°åå¹´çº§é€‰æ‹©è¢«è®°å¿†

### ç”¨æˆ·ä½“éªŒï¼ˆå»ºè®®80%ä»¥ä¸Šï¼‰

- [ ] åŠ è½½é€Ÿåº¦ < 1ç§’
- [ ] æ“ä½œå“åº”åŠæ—¶ï¼ˆ< 300msï¼‰
- [ ] é”™è¯¯æç¤ºæ¸…æ™°æ˜“æ‡‚
- [ ] æ— æ˜æ˜¾å¡é¡¿æˆ–é—ªçƒ
- [ ] åŠ¨ç”»æµç•…è‡ªç„¶

### ç¨³å®šæ€§ï¼ˆå¿…é¡»100%é€šè¿‡ï¼‰

- [ ] æ— æ§åˆ¶å°é”™è¯¯
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] ç½‘ç»œå¼‚å¸¸æ—¶æœ‰å‹å¥½æç¤º
- [ ] äº‘å‡½æ•°è°ƒç”¨å¤±è´¥æ—¶æœ‰é™çº§å¤„ç†

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. [TDesign Picker ç»„ä»¶æ–‡æ¡£](https://tdesign.tencent.com/miniprogram/components/picker)
2. [å¾®ä¿¡äº‘å¼€å‘æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)
3. [äº‘å‡½æ•°å¼€å‘æŒ‡å—](./CLOUD_FUNCTION_GUIDE.md)
4. [å¹´çº§å¼•æ“å¿«é€Ÿå¼€å§‹](./GRADE_ENGINE_QUICK_START.md)
5. [è°ƒè¯•æŒ‡å—](./GRADE_SELECTOR_DEBUG.md)

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœæŒ‰ç…§æœ¬æ–‡æ¡£æ“ä½œåé—®é¢˜ä»æœªè§£å†³ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç¯å¢ƒä¿¡æ¯**
   - å¾®ä¿¡å¼€å‘è€…å·¥å…·ç‰ˆæœ¬
   - å°ç¨‹åºåŸºç¡€åº“ç‰ˆæœ¬
   - æ“ä½œç³»ç»Ÿç‰ˆæœ¬

2. **æ§åˆ¶å°å®Œæ•´æ—¥å¿—**
   ```
   è¯·å¤åˆ¶ç²˜è´´æ§åˆ¶å°æ‰€æœ‰è¾“å‡ºï¼ˆåŒ…æ‹¬é”™è¯¯ã€è­¦å‘Šã€æ—¥å¿—ï¼‰
   ```

3. **ç½‘ç»œè¯·æ±‚æ—¥å¿—**
   - æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Network é¢æ¿
   - æˆªå›¾æˆ–å¤åˆ¶äº‘å‡½æ•°è°ƒç”¨è®°å½•

4. **æ“ä½œæ­¥éª¤**
   - è¯¦ç»†æè¿°ä½ çš„æ“ä½œæ­¥éª¤
   - é¢„æœŸç»“æœ vs å®é™…ç»“æœ

5. **æˆªå›¾/å½•å±**
   - é—®é¢˜ç°è±¡æˆªå›¾
   - æ§åˆ¶å°é”™è¯¯æˆªå›¾

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2025-11-30  
**ä¿®å¤ç‰ˆæœ¬ï¼š** v1.0.1  
**ä¿®å¤å·¥ç¨‹å¸ˆï¼š** AI Assistant  
**å®¡æ ¸çŠ¶æ€ï¼š** âœ… å¾…æµ‹è¯•éªŒè¯
